SISTEMA DE AUTENTICACI√ìN KIOSCOSTOCK

Quiero redise√±ar completamente el sistema de autenticaci√≥n de mi aplicaci√≥n con una arquitectura clara por roles (empleador / empleado).

La pantalla principal debe tener tres botones:

Registrar Negocio

Acceder Empleador

Acceder Empleado

üîπ Arquitectura de Base de Datos (Firestore)

Colecci√≥n principal: usuarios

Estructura del documento:

usuarios/{uid}
{
  uid: string,
  email: string,
  tipo: "empleador" | "empleado",
  kioscoId: string,
  estado: "activo",
  fechaCreacion: serverTimestamp()
}


El sistema funciona as√≠:

1 empleador por negocio

Hasta 2 empleados por negocio

Los datos del kiosco se comparten mediante kioscoId

üî• FLUJOS FUNCIONALES
1Ô∏è‚É£ Registrar Negocio (Solo crea EMPLEADOR)

Flujo:

Crear usuario en Firebase Authentication (email y contrase√±a).

Generar un kioscoId √∫nico.

Crear documento en usuarios/{uid} con:

{
  uid: auth.uid,
  email: email,
  tipo: "empleador",
  kioscoId: kioscoIdGenerado,
  estado: "activo",
  fechaCreacion: serverTimestamp()
}


Redirigir al dashboard del empleador.

Si el usuario ya existe en Auth o en Firestore, mostrar mensaje claro:
"Este usuario ya est√° registrado."

2Ô∏è‚É£ Acceder Empleador

Flujo:

Login con email y contrase√±a (Firebase Auth).

Una vez autenticado, buscar documento en usuarios/{uid}.

Validar:

tipo === "empleador"

estado === "activo"

Si no cumple:

Mostrar mensaje de error.

Cerrar sesi√≥n inmediatamente.

Si cumple:

Redirigir al dashboard del empleador.

3Ô∏è‚É£ Acceder Empleado

El empleado tambi√©n debe tener usuario y contrase√±a propios (Firebase Auth).

Flujo:

Login con email y contrase√±a.

Buscar documento en usuarios/{uid}.

Validar:

tipo === "empleado"

estado === "activo"

kioscoId v√°lido

Si no cumple:

Mostrar mensaje de error.

Cerrar sesi√≥n.

Si cumple:

Redirigir al dashboard del empleado.

üö® REGLA DE SEGURIDAD OBLIGATORIA

Nunca permitir acceso solo porque Firebase Auth fue exitoso.

El flujo correcto siempre debe ser:

Auth OK
‚Üí Verificar documento en Firestore
‚Üí Validar rol y estado
‚Üí Permitir acceso

Si no existe documento en usuarios, bloquear acceso.

üîπ Requisitos T√©cnicos

Usar Firebase Authentication.

Usar Firestore.

Implementar todo con async/await.

Manejar errores con try/catch.

Mostrar mensajes claros en el frontend.

No permitir acceso directo al dashboard sin validaci√≥n previa.

Generar el c√≥digo completo necesario (HTML + JS) respetando la estructura actual del proyecto.

üèóÔ∏è Mejora futura (Escalabilidad)

Preparar el sistema para que m√°s adelante los empleados puedan almacenarse tambi√©n en:

kioscos/{kioscoId}/empleados/{uid}