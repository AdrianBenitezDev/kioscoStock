ESTADO FUNCIONAL - KIOSCO STOCK
Fecha de revision: 2026-02-16

1) CREAR PRODUCTO
Estado: FUNCIONANDO
Frontend:
- Alta valida campos clave: nombre, categoria, precio, costo proveedor y stock.
- Guarda en IndexedDB primero (modo offline-friendly).
- Si hay 30 o mas pendientes, dispara sincronizacion automatica.
Backend:
- syncProducts valida tenant, datos y escribe en Firestore (tenants/{tenantId}/productos/{codigo}).
Observaciones:
- Flujo de creacion y sincronizacion esta consistente.
- Eliminacion de producto usa callable adicional y puede quedar solo local si falla nube (comportamiento esperado por conectividad).

2) CREAR VENTA
Estado: FUNCIONANDO CON MODO HIBRIDO
Frontend:
- Intenta primero createSale en backend (autoritativo).
- Si backend no disponible por conectividad, cae a modo local offline y registra la venta en IndexedDB.
- Soporta sync posterior de ventas pendientes (syncSales).
Backend:
- createSale valida stock en Firestore, descuenta stock y calcula total/costo/ganancia real por servidor.
- syncSales permite consolidar ventas offline luego.
Observaciones:
- Estrategia correcta para continuidad operativa.
- Hay mezcla de nombres ganaciaReal/gananciaReal en algunas capas (no rompe flujo, pero conviene normalizar).

3) HACER CAJA (CIERRE)
Estado: FUNCIONANDO CON INCONSISTENCIA DE ALCANCE
Frontend:
- Muestra resumen diario y permite cierre.
- Si no hay conexion, genera cierre local provisional.
- Si hay conexion, llama closeCashbox backend.
Backend:
- closeCashbox cierra ventas con filtro usuarioUid == uid.
Hallazgo importante:
- Para empleador, el frontend muestra vista de todo el kiosco, pero backend cierra solo ventas del usuario autenticado.
Impacto:
- Posible diferencia entre lo que el empleador ve (resumen global) y lo que efectivamente cierra en backend.

CONCLUSION GENERAL
- Crear producto: OK
- Crear venta: OK (online + offline)
- Hacer caja: OK operativo, pero requiere alinear regla de alcance en backend para empleador si se desea cierre global real.
